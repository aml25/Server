var TuneFarm = function(server){
	var self = this;
	self.path = require("path");
	self.dir = self.path.join(__dirname, "../public/TuneFarm");
	self.io = require("socket.io")(server);
	self.fs = require("fs");

	self.currRoom = "";

	self.io.on("connection",function(socket){
		console.log("hello new socket");

		//join some room
		socket.on("join", function(data){
			this.leave(self.currRoom);
			self.currRoom = data.room;
			console.log("joining " + self.currRoom);
			this.join(self.currRoom);
		});

	});

	self.init = function(){
		console.log("new Tune Farm session");
	}

	self.handleRequest = function(req,res){
		console.log(req.url);
		console.log(req.query);

		//requesting an image
		if(req.url.indexOf("img/") > -1){
			console.log("just requested: " + req.url.split("/").pop());
			var imgPath = self.path.join(self.dir + "/img/" + req.url.split("/").pop());
			console.log("path: " + imgPath);
			res.sendFile(imgPath);
		}
		else{
			res.sendFile(self.dir + "/index.html");
		}
	}
}

module.exports = TuneFarm;