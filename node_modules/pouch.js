/*pouch db interaction*/

var PouchDB = require("pouchdb");
var db = new PouchDB('http://localhost:5984/tunefarm');

//create a room or join an existing one
exports.joinRoom = function(roomName, _callback){
	db.put({
		_id: roomName,
		room: roomName,
		tracks: [],
		currTrackIndex: 0,
		currTrackTime: 0,
		isPlaying: false,
		"public": false
	}).then(function(response){
		db.get(roomName).then(function(doc){
			_callback(doc);
		})
	}).catch(function(err){
		console.log(err);
	});
}

//duplicate the existing room and start a new one with a new name
exports.renameRoom = function(roomData, _callback){
	db.get(roomData.oldRoom).then(function(doc){
		db.put({
			_id: roomData.room,
			_rev: doc._rev,
			room: roomData.room,
			tracks: doc.tracks,
			currTrackIndex: doc.currTrackIndex,
			currTrackTime: doc.currTrackTime,
			isPlaying: doc.isPlaying,
			"public": doc["public"]
		});

		db.remove(doc); //remove the old one
	}).then(function(response) {
		db.get(roomData.room).then(function(doc){
			_callback(doc);
		});
	}).catch(function (err) {
		console.log(err);
	});
}